var smjq=jQuery,_typei=0,weichuncai_text="";function getEvent(){return window.event||arguments.callee.caller.arguments[0]}smjq(document).ready((function(){var e=getCookie("historywidth"),t=getCookie("historyheight");if(null!=e&&null!=t)var i=e,c=t;else i=document.documentElement.clientWidth-200-imagewidth,c=document.documentElement.clientHeight-180-imageheight;var n=document.documentElement.clientWidth-100,a=document.documentElement.clientHeight-20,s=0,o=0,l=0,u=0,d=!1,m=document.onmousemove,h=document.onmouseup;smjq("body").append('<div id="smchuncai" onfocus="this.blur();" style="color:#626262;z-index:999;"><div id="chuncaiface"></div><div id="dialog_chat"><div id="chat_top"></div><div id="dialog_chat_contents"><div id="dialog_chat_loading"></div><div id="tempsaying"></div><div id="showchuncaimenu"><ul class="wcc_mlist" id="shownotice">显示公告</ul><ul class="wcc_mlist" id="chatTochuncai">聊&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;天</ul><ul class="wcc_mlist" id="foods">吃 零 食</ul><ul class="wcc_mlist" id="aboutmanage">关&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;于</ul><ul class="wcc_mlist" id="lifetimechuncai">生存时间</ul><ul class="wcc_mlist" id="closechuncai">关闭春菜</ul></div><div><ul id="chuncaisaying"></ul></div><div id="getmenu"> </div></div><div id="chat_bottom"></div></div></div>'),smjq("#smchuncai").append('<div id="addinput"><div id="inp_l"><input id="talk" type="text" name="mastersay" value="" /> <input id="talkto" type="button" value=" " /></div><div id="inp_r"> X </div></div>'),smjq("body").append('<div id="callchuncai">召唤春菜</div>'),"close"==getCookie("is_closechuncai")&&closechuncai_init(),getdata("getnotice"),setFace(1),smjq("#smchuncai").css("left",i+"px"),smjq("#smchuncai").css("top",c+"px"),smjq("#smchuncai").css("width",imagewidth+"px"),smjq("#smchuncai").css("height",imageheight+"px"),smjq("#callchuncai").attr("style","top:"+a+"px; left:"+n+"px; text-align:center;"),smcc=document.getElementById("smchuncai"),smcc.onmousedown=function(){var e=getEvent();d=!0,s=e.clientX,o=e.clientY;var t=document.getElementById("smchuncai");l=parseInt(t.style.top),u=parseInt(t.style.left),(isFirefox=navigator.userAgent.indexOf("Firefox")>0)&&window.getSelection().removeAllRanges(),document.onmousemove=function(){if(d){var e=getEvent(),i=u+e.clientX-s,c=l+e.clientY-o;t.style.left=i+"px",t.style.top=c+"px"}},document.onmouseup=function(){if(d){var e=t.style.left,i=t.style.top;e=e.replace("px",""),i=i.replace("px",""),setCookie("historywidth",e,2592e6),setCookie("historyheight",i,2592e6),document.onmousemove=m,document.onmouseup=h,d=!1,s=0,o=0,l=0,u=0}}},smjq("#getmenu").click((function(){chuncaiMenu(),setFace(1)})),smjq("#shownotice").click((function(){getdata("getnotice"),setFace(1)})),smjq("#closechuncai").click((function(){setFace(3),closechuncai()})),smjq("#callchuncai").click((function(){setFace(2),callchuncai(),setCookie("is_closechuncai","",2592e6)})),smjq("#shownotice").click((function(){setFace(1),closeChuncaiMenu()})),smjq("#lifetimechuncai").click((function(){closeChuncaiMenu(),closeNotice(),setFace(2),getdata("showlifetime")})),smjq("#chatTochuncai").click((function(){showInput()})),smjq("#inp_r").click((function(){closeInput(),chuncaiSay("不聊天了吗？(→_→)"),setFace(3)})),smjq("#talkto").click((function(){getdata("talking")})),smjq("#aboutmanage").click((function(){closeChuncaiMenu(),closeNotice(),smjq("#getmenu").css("display","none"),chuncaiSay("你想了解我主人？跟我来吧～～～"),setFace(2),setTimeout((function(){window.location.href=_about_path}),2e3)})),smjq("#foods").click((function(){closeChuncaiMenu(),closeNotice(),getdata("foods")})),document.onmousemove=function(){stoptime(),tol=0,setTime()},talkSelf(talktime),document.getElementById("smchuncai").onmouseover=function(){talkobj&&clearTimeout(talkobj),talkSelf(talktime=0)}}));var eattimes=0,timenum;function eatfood(e){var t=getCookie("eattimes");if(parseInt(t)>parseInt(9))chuncaiSay("主人是个大混蛋！！"),setFace(3),closechuncai_evil();else if(parseInt(t)>parseInt(7))chuncaiSay(".....................肚子要炸了，死也不要再吃了～～！！！TAT"),setFace(3);else if(parseInt(t)==parseInt(5))chuncaiSay("我已经吃饱了，不要再吃啦......"),setFace(3);else if(parseInt(t)==parseInt(3))chuncaiSay("多谢款待，我吃饱啦～～～ ╰（￣▽￣）╭"),setFace(2);else{getdata("eatsay",e.replace("f",""))}setCookie("eattimes",++eattimes,6e5)}function chuncaiMenu(){clearChuncaiSay(),closeInput(),chuncaiSay("准备做什么呢？"),smjq("#showchuncaimenu").css("display","block"),smjq("#getmenu").css("display","none"),smjq("#chuncaisaying").css("display","none")}function closeChuncaiMenu(){clearChuncaiSay(),smjq("#showchuncaimenu").css("display","none"),showNotice(),smjq("#getmenu").css("display","block")}function showNotice(){smjq("#chuncaisaying").css("display","block")}function closechuncai(){stopTalkSelf(),chuncaiSay("记得再叫我出来哦..."),smjq("#showchuncaimenu").css("display","none"),setTimeout((function(){smjq("#smchuncai").fadeOut(1200),smjq("#callchuncai").css("display","block")}),2e3),setCookie("is_closechuncai","close",2592e6)}function closechuncai_evil(){stopTalkSelf(),smjq("#showchuncaimenu").css("display","none"),setTimeout((function(){smjq("#smchuncai").fadeOut(1200),smjq("#callchuncai").css("display","block")}),2e3)}function closechuncai_init(){stopTalkSelf(),smjq("#showchuncaimenu").css("display","none"),setTimeout((function(){smjq("#smchuncai").css("display","none"),smjq("#callchuncai").css("display","block")}),30)}function callchuncai(){talkSelf(talktime),smjq("#smchuncai").fadeIn("normal"),smjq("#callchuncai").css("display","none"),closeChuncaiMenu(),closeNotice(),chuncaiSay("我回来啦～"),setCookie("is_closechuncai","",2592e6)}function chuncaiSay(e){clearChuncaiSay(),smjq("#tempsaying").append(e),smjq("#tempsaying").css("display","block"),weichuncai_text=e,typeWords()}function clearChuncaiSay(){document.getElementById("tempsaying").innerHTML=""}function closeNotice(){smjq("#chuncaisaying").css("display","none")}function showInput(){closeChuncaiMenu(),closeNotice(),chuncaiSay("............?"),smjq("#addinput").css("display","block")}function closeInput(){setFace(3),smjq("#addinput").css("display","none")}function clearInput(){document.getElementById("talk").value=""}function createFace(e,t,i){smjq("head").append('<div id="hiddenfaces"><img id="hf1" src="'+e+'" /><img id="hf2" src="'+t+'" /><img id="hf3" src="'+i+'" /></div>'),setFace(1)}function setFace(e){obj=document.getElementById("hf"+e).src,smjq("#chuncaiface").attr("style","background:url("+obj+") no-repeat scroll 50% 0% transparent; width:"+imagewidth+"px;height:"+imageheight+"px;")}function getdata(el,id){smjq.ajax({type:"GET",url:_weichuncai_jsonpath,cache:"false",dataType:"html",contentType:"application/json; charset=utf8",beforeSend:function(){smjq("#tempsaying").css("display","none"),smjq("#dialog_chat_loading").fadeIn("normal")},success:function(data){smjq("#dialog_chat_loading").css("display","none"),smjq("#tempsaying").css("display","");var dat=eval("("+data+")");if("getnotice"==el)chuncaiSay(dat.notice),setFace(1);else if("showlifetime"==el)BirthDay=new Date(dat.showlifetime),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=-24*(daysold-e_daysold),hrsold=Math.floor(e_hrsold),e_minsold=-60*(hrsold-e_hrsold),minsold=Math.floor(-60*(hrsold-e_hrsold)),seconds=Math.floor(-60*(minsold-e_minsold)),chuncaiSay("我已经与主人 一起生存了 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分钟 "+seconds+" 秒的快乐时光啦～*^_^*");else if("talking"==el){var talkcon=smjq("#talk").val(),i=in_array(talkcon,dat.ques),types=typeof i;"boolean"!=types?(chuncaiSay(dat.ans[i]),setFace(2)):(chuncaiSay(".......................嗯？"),setFace(3)),clearInput()}else if("foods"==el){var str="",arr=dat.foods,preg=/function/;for(var i in arr)""==arr[i]||preg.test(arr[i])||(str+='<ul id="f'+i+'" class="eatfood" onclick="eatfood(this.id)">'+arr[i]+"</ul>");chuncaiSay(str)}else if(el="eatsay"){var str=dat.eatsay[id];chuncaiSay(str),setFace(2)}else if(el="talkself"){var arr=dat.talkself;return arr}},error:function(){chuncaiSay("好像出错了，是什么错误呢...请联系管理猿")}})}function in_array(e,t){for(var i in t)if(t[i]==e)return i;return!1}var tol=0,goal=600;function setTime(){tol++,timenum=window.setTimeout("setTime('"+tol+"')",1e3),parseInt(tol)==parseInt(goal)&&(stopTalkSelf(),closeChuncaiMenu(),closeNotice(),closeInput(),chuncaiSay("主人跑到哪里去了呢...."),setFace(3),stoptime())}function stoptime(){timenum&&clearTimeout(timenum)}var talktime=0,talkself=60,talkobj,tsi=0,talkself_arr=[["白日依山尽，黄河入海流，欲穷千里目，更上.....一层楼？","1"],["我看见主人熊猫眼又加重了！","3"],["我是不是很厉害呀～～？","2"],["5555...昨天有个小孩子跟我抢棒棒糖吃.....","3"],["昨天我好像看见主人又在众人之前卖萌了哦～","2"]];function talkSelf(e){e++,parseInt(e%talkself)==parseInt(9)&&(closeChuncaiMenu(),closeNotice(),closeInput(),tsi=Math.floor(Math.random()*talkself_arr.length+1)-1,chuncaiSay(talkself_arr[tsi][0]),setFace(talkself_arr[tsi][1])),talkobj=window.setTimeout("talkSelf("+e+")",1e3)}function stopTalkSelf(){talkobj&&clearTimeout(talkobj)}function arrayShuffle(e){for(var t=[],i=e.length;i--;)t[t.length]=e.splice(Math.floor(Math.random()*(i+1)),1);return t}function typeWords(){var e=1,t=weichuncai_text.substr(0,_typei);"<"==weichuncai_text.substr(_typei,1)&&(t+=weichuncai_text.substr(_typei,weichuncai_text.substr(_typei).indexOf(">")+1),e=weichuncai_text.substr(_typei).indexOf(">")+1),_typei+=e,document.getElementById("tempsaying").innerHTML=t,txtst=setTimeout("typeWords()",20),_typei>weichuncai_text.length&&(clearTimeout(txtst),_typei=0)}function setCookie(e,t,i){var c=new Date;c.setTime(c.getTime()+i),document.cookie=0==i?e+"="+t+";":e+"="+t+"; expires="+c.toGMTString()}function getCookie(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null}